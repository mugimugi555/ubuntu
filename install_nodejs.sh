#!/usr/bin/bash

# =============================================================
# Node.js & npm & Yarn 最新版インストールスクリプト
# =============================================================

echo "✅ Node.js の最新版をインストールします..."

# 必要なパッケージの更新
sudo apt update -y
sudo apt install -y curl

# 既存の nodejs を削除
echo "🗑️ 既存の Node.js を削除..."
sudo apt purge -y nodejs npm
sudo apt autoremove -y

# =============================================================
# Node.js を n を使って最新版に更新
# =============================================================
echo "🚀 Node.js の最新版をインストール..."

# `npm` をインストール
sudo apt install -y npm

# `n` コマンドをグローバルインストール
sudo npm install -g n

# 最新の安定版 Node.js をインストール
sudo n stable

# 古い `nodejs` パッケージを削除
sudo apt purge -y nodejs
sudo apt autoremove -y

# =============================================================
# Yarn のインストール
# =============================================================
echo "📦 Yarn をインストール..."
sudo npm install -g yarn

# =============================================================
# バージョン確認
# =============================================================
echo "✅ インストールされたバージョン:"
node -v
npm -v
yarn -v

# シェルを再読み込みして変更を適用
exec $SHELL -l
